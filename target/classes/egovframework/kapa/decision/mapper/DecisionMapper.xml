<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.kapa.decision.mapper.DecisionMapper">

    
    <insert id="insertDecisionNotice" parameterType="egovframework.kapa.domain.Decision_Notice">
    	insert into TB_Decision_Notice(decisionId, docNumber, docTitle, receiver, requestStartDate, requestEndDate, newsletterDay, delCheck, regdate, uptdate, publicationExpiryDate)
    	values(#{decisionId}, #{docNumber}, #{docTitle}, #{receiver}, #{requestStartDate}, #{requestEndDate}, #{newsletterDay}, #{delCheck}, #{regdate},#{uptdate}, #{publicationExpiryDate})
    </insert>
    
  	<insert id="insertMeetings" parameterType="egovframework.kapa.domain.Decision_Date">
    	insert into TB_Decision_Date(consultationDate, delCheck, regdate, uptdate)
    	values(#{consultationDate}, #{delCheck}, #{regdate}, #{uptdate})
    </insert>
    
	<insert id="insertAgendaDate" parameterType="egovframework.kapa.domain.Decision_AgendaDate">
    	insert into TB_Decision_AgendaDate(decisionId,selectDate, delCheck, regdate, uptdate)
    	values(#{decisionId},#{selectDate}, #{delCheck}, #{regdate}, #{uptdate})
    </insert>

		
	<update id="updateState">
		update TB_Decision set decisionState = #{decisionState} where seqNo = #{seqNo}
	</update>
	
	<update id="updateStateFinal">
		update TB_Decision set decisionState = #{decisionState} , agendaState = '1' where seqNo = #{seqNo}
	</update>
	
	<update id="updateStep1">
		<!-- update TB_Decision set agendaState = #{agendaState} , relatedLaws = #{relatedLaws} , reviewOpinion = #{reviewOpinion} where seqNo = #{seqNo} -->
		<!-- update TB_Decision set agendaState = #{agendaState} , relatedLaws = #{relatedLaws} , relatedLaws2 = #{relatedLaws2}, reviewOpinion = #{reviewOpinion} where seqNo = #{seqNo} -->
		update TB_Decision set agendaState = #{agendaState} where seqNo = #{seqNo}
	</update>
	
	<update id="updateStep2">
		<!-- update TB_Decision_Opinion set completionCheck = '1', opinionText = #{content} , relatedLaws = #{relatedLaws} , reviewOpinion = #{reviewOpinion} where seqNo = #{seqNo} -->
		update TB_Decision_Opinion set completionCheck = '1', opinionText = #{content} , relatedLaws = #{relatedLaws}, relatedLaws2 = #{relatedLaws2} , reviewOpinion = #{reviewOpinion} where seqNo = #{seqNo}
	</update>
	
	<update id="updateStep3">
		update TB_Decision set agendaState = #{agendaState} where seqNo = #{decisionId}
	</update>
	
	
	<select id="getDecisionView" resultType="egovframework.kapa.domain.Decision" >
		SELECT *
		
		FROM TB_Decision 
		
		<where>
			seqNo = #{decisionId}
			AND delCheck = '0'
  		</where>
	</select> 
	
   <select id="getDecisionViewMasterID" resultType="egovframework.kapa.domain.Decision" >
		SELECT *
		
		FROM TB_Decision 
		
		<where>
			masterID = #{masterID}
			AND delCheck = '0'
  		</where>
	</select> 
	<select id="getDecisionNoticeView" resultType="egovframework.kapa.domain.Decision_Notice" >
		SELECT TOP 1 *
		
		FROM TB_Decision_Notice 
		
		<where>
			decisionId = #{decisionId}
			AND delCheck = '0'
  		</where>
	</select> 
	
	<select id="getDecisionAnnouncementList" resultType="egovframework.kapa.domain.Decision" >
		SELECT *
		
		FROM TB_Decision 
		
		<where>
			decisionState >= '1'
			AND delCheck = '0'
  		</where>
		
		ORDER BY seqNo DESC
		
		OFFSET (#{page}-1)*#{listSize} ROW
		FETCH NEXT #{listSize} ROW ONLY
	</select> 
	
	
	<select id="getDecisionAgendaList" resultType="egovframework.kapa.domain.Decision" >
		SELECT *
		
		FROM TB_Decision 
		
		<where>
			decisionState >= '5'
			AND delCheck = '0'
  		</where>
		
		ORDER BY seqNo DESC
		
		OFFSET (#{page}-1)*#{listSize} ROW
		FETCH NEXT #{listSize} ROW ONLY
	</select> 
	
	
	<select id="getDecisionOpinionList" resultType="egovframework.kapa.domain.Decision_Opinion" >
		SELECT *
		
		FROM TB_Decision_Opinion
		
		<where>
			decisionId = #{decisionId}
			AND delCheck = '0'
  		</where>

	</select> 
	
	
	<select id="getDecisionOpinionItemList" resultType="egovframework.kapa.domain.Decision_Opinion_Item" >
		SELECT *
		
		FROM TB_Decision_Opinion_Item 
		
		<where>
			reptSeq = #{viewSeq}
			AND delCheck = '0'
  		</where>

	</select> 
	
	<select id="getDecisionOpinionTypeItemList" parameterType="Map" resultType="egovframework.kapa.domain.Decision_Opinion_Item" >
		SELECT *
		
		FROM TB_Decision_Opinion_Item 
		
		<where>
			reptSeq = #{viewSeq}
			AND opinionType = #{type}
			AND delCheck = '0'
  		</where>

	</select> 
	
	<select id="getDecisionOpinionTypeItemCount" parameterType="Map" resultType="Integer" >
		SELECT count(*) as listCnt
		
		FROM TB_Decision_Opinion_Item 
		
		<where>
			reptSeq = #{viewSeq}
			AND opinionType = #{type}
			AND delCheck = '0'
  		</where>

	</select> 
	

	 <!-- 게시글 갯수 -->
    <select id="getDecisionAnnouncementCnt" resultType="Integer">
        SELECT count(*) as listCnt
        FROM TB_Decision AS M
  		<where>
			decisionState >= '1'
			AND delCheck = '0'
  		</where>
    </select>

	 <!-- 게시글 갯수 -->
    <select id="getDecisionAgendaCnt" resultType="Integer">
        SELECT count(*) as listCnt
        FROM TB_Decision AS M
  		<where>
			decisionState >= '5'
			AND delCheck = '0'
  		</where>
    </select>


	 <!-- Notice 파일 갯수 -->
    <select id="getDecisionFileCnt" resultType="Integer">
        SELECT count(*) as listCnt
        FROM TB_Decision_File_Notice AS M
  		<where>
			M.decisionId = #{decisionId}
			AND M.delCheck = '0'
  		</where>
    </select>

	 <!-- City 파일 갯수 -->
    <select id="getDecisionCityFileCnt" resultType="Integer">
        SELECT count(*) as listCnt
        FROM TB_Decision_File_Cites AS M
  		<where>
			M.decisionId = #{decisionId}
			AND M.delCheck = '0'
  		</where>
    </select>

    
   	<select id="getCityPlan" resultType="egovframework.kapa.domain.Decision_Cityplan" >
		SELECT *
		
		FROM TB_Decision_CityPlan 
		
		<where>
			decisionId = #{decisionId}
			AND delCheck = '0'
  		</where>
	</select> 
	
	<select id="getTarget" resultType="egovframework.kapa.domain.Decision_Target" >
		SELECT *
		
		FROM TB_Decision_Target 
		
		<where>
			DecisionId = #{decisionId}
			AND del_check = '0'
  		</where>
	</select> 
	
	<select id="getConsultationDate" resultType="egovframework.kapa.domain.Decision_ConsultationDate" >
		SELECT *
		
		FROM TB_Decision_ConsultationDate 
		
		<where>
			decisionId = #{decisionId}
			AND delCheck = '0'
  		</where>
	</select> 

	
	<insert id="insertDecisionFile" parameterType="egovframework.kapa.domain.Decision_File">
    	insert into TB_Decision_File(decisionId, fileType, fileSeq, delCheck, rank, regdate, uptdate, fileDescription)
    	values(#{decisionId}, #{fileType}, #{fileSeq}, #{delCheck}, #{rank}, #{regdate}, #{uptdate}, #{fileDescription})
    </insert>
    
    	
	<select id="getDecisionFileList" resultType="egovframework.kapa.domain.Decision_File" >
		SELECT *
		FROM TB_Decision_File 
		<where>
			decisionId  = #{decisionId}
			AND delCheck = '0'
  		</where>
	</select> 
	

	<select id="getAgendaRegisterList" resultType="egovframework.kapa.domain.Decision" >
		SELECT *
		
		FROM TB_Decision 
		
		<where>
			decisionState = '6'
			AND agendaState >= '1'
			AND delCheck = '0'
  		</where>
		
		ORDER BY seqNo DESC
		
		OFFSET (#{page}-1)*#{listSize} ROW
		FETCH NEXT #{listSize} ROW ONLY
	</select> 
	
	<!-- 게시글 갯수 -->
    <select id="getAgendaRegisterCnt" resultType="Integer">
        SELECT count(*) as listCnt
        FROM TB_Decision AS M
  		<where>
			decisionState = '6'
			AND agendaState >= '1'
			AND delCheck = '0'
  		</where>
    </select>

    <select id="selectCaseMeeting" parameterType="Map" resultType="egovframework.kapa.domain.Decision_Date">

		SELECT [seqNo]
		      ,[consultationDate]
		      ,[delCheck]
		      ,[regdate]
		      ,[uptdate]
		  FROM [land-seoul3].[dbo].[TB_Decision_Date]
		
		  WHERE consultationDate BETWEEN #{start} AND #{end}
		  ORDER BY consultationDate

    </select>

	<!-- 게시글 갯수 -->
    <select id="getDateList" resultType="egovframework.kapa.domain.Decision_Date">
        SELECT *
        FROM TB_Decision_Date 
  		<where>
			 delCheck = '0'
  		</where>
    </select>

	<!-- 의견 갯수 -->
    <select id="getOpinionList" resultType="egovframework.kapa.domain.Decision_Opinion">
        SELECT *
        FROM TB_Decision_Opinion 
  		<where>
			decisionId = #{decisionId}
			AND delCheck = '0'
  		</where>
    </select>

	
	<!-- 게시글 갯수 -->
    <select id="getOpinionCompletionCount" resultType="Integer">
        SELECT count(*) as listCnt
        FROM TB_Decision_Opinion 
  		<where>
			decisionId = #{decisionId}
			AND completionCheck != '1'
			AND delCheck = '0'
  		</where>
    </select>
    
    <select id="getFileByDeicisionFileSeq" resultType="egovframework.kapa.file.domain.FileVO">
        SELECT * 
        FROM TB_FILE 
  		<where>
			seqNo = #{seqNo}
  		</where>
    </select>
	
	<insert id="insertDecisionAnnoucementFile" parameterType="egovframework.kapa.domain.Decision_Announcement_File">
    	insert into TB_Announcement_File(decisionId, fileSeq, delCheck, regdate, uptdate, fileDescription)
    	values(#{decisionId}, #{fileSeq}, #{delCheck}, #{regdate}, #{uptdate}, #{fileDescription})
    </insert>


	<!-- 의견 갯수 -->
    <select id="getDecisionOpinionInfo" resultType="egovframework.kapa.domain.Decision_Opinion">
        SELECT *
        FROM TB_Decision_Opinion 
  		<where>
			seqNo = #{viewSeq}
			AND delCheck = '0'
  		</where>
    </select>



	
</mapper>